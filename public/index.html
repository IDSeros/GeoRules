<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Página de Inicio</title>
  <link rel="stylesheet" href="indexstyle.css" />
</head>
<body>
  <header>
    <div class="container">
      <nav>
        <div class="brand">
          <img src="GeoRulelogo.png" alt="Logo GeoRules" width="30" height="30">
          GeoRules
        </div>
        <div class="nav-links" role="navigation" aria-label="Menú principal">
          <a href="#sobre-nosotros">Sobre Nosotros</a>
          <a href="#mas-info">Más Info.</a>
        </div>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <div class="card">
        <h1>Bienvenido a GeoRules</h1>
        <p class="lead">Una pagina web cuya función principal es apoyar a las personas a la hora de conocer mas acerca de sus lugares concurridos.</p>
      </div>

      <aside class="card">
        <h2>Inicia Sesión</h2>
        <p class="lead">Inicia ahora mismo para empezar tu aventura en nuestro mapa personalizado con reglas de tus lugares preferidos.</p>
        <button class="btn" id="open-login">Iniciar Sesión</button>
      </aside>
    </section>

    <section id="sobre-nosotros" class="card" style="margin-top:1rem">
      <h2>Sobre Nosotros</h2>
      <p>Somos un equipo de desarrolladores enfocados en esparcir conocimiento general a las personas alrededor del mundo mediante neustras aplicaciones.</p>
    </section>

    <section id="mas-info" class="card" style="margin-top:1rem">
      <h2>Más Info.</h2>
      <p>Puedes conocer más de nosotros por estos medios:</p>
      <ul>
        <li>Redes: Instagram</li>
        <li>Contacto: 81 2904 7280</li>
        <li>Términos y condiciones</li>
      </ul>
    </section>
  </main>

  <footer class="footer">
    © " + new Date().getFullYear() + " MiSitio — Todos los derechos reservados.
  </footer>

  <!-- Modal de login y signup -->
  <div class="modal-backdrop" id="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal card" role="document">
      <!-- Login Form -->
      <div id="login-view">
        <h3>Iniciar sesión</h3>
        <form id="login-form">
          <div class="form-group">
            <label for="login-email">Correo electrónico</label>
            <input id="login-email" type="email" required placeholder="tucorreo@ejemplo.com">
          </div>
          <div class="form-group">
            <label for="login-password">Contraseña</label>
            <input id="login-password" type="password" required placeholder="••••••••">
          </div>
          <div class="hyperlink">
            <label id="open-signup" style="cursor:pointer;">¿No tiene una cuenta? Registrarse</label>
          </div>
          <div style="display:flex;gap:.5rem;justify-content:flex-end">
            <button type="button" id="close-modal" class="btn" style="background:#e2e8f0;color:#0f172a">Cancelar</button>
            <button type="submit" class="btn">Entrar</button>
          </div>
        </form>
      </div>

      <!-- Signup Form -->
      <div id="signup-view" style="display: none;">
        <h3>Registrarse</h3>
        <form id="signup-form">
          <div class="form-group">
            <label for="name">Nombre de Usuario</label>
            <input type="text" id="name" required placeholder="Nombre de Ususario...">
          </div>
          <div class="form-group">
            <label for="signup-email">Correo electrónico</label>
            <input id="signup-email" type="email" required placeholder="tucorreo@ejemplo.com">
          </div>
          <div class="form-group">
            <label for="signup-password">Contraseña</label>
            <input id="signup-password" type="password" required placeholder="••••••••">
          </div>
          <div class="form-group">
            <label for="confirmpass">Confirmar contraseña</label>
            <input id="confirmpass" type="password" required placeholder="••••••••">
          </div>
          <div class="form-group" id="admin-code-group">
            <label for="admin-code">Código de administrador (si aplica)</label>
            <input id="admin-code" type="text" placeholder="Código admin (opcional)">
          </div>
          <div class="hyperlink">
            <label id="back-to-login" style="cursor:pointer;">¿Ya tienes una cuenta? Iniciar sesión</label>
          </div>
          <div style="display:flex;gap:.5rem;justify-content:flex-end">
            <button type="button" id="close-modal-signup" class="btn" style="background:#e2e8f0;color:#0f172a">Cancelar</button>
            <button type="submit" class="btn">Crear cuenta</button>
          </div>
        </form>
      </div>
    </div>
  </div>


  <script>
    (function () {
      try {
        document.querySelector('footer').textContent =
          '© ' + new Date().getFullYear() + ' MiSitio — Todos los derechos reservados.';
      } catch (e) {}

      const modal = document.getElementById('modal');
      const loginView = document.getElementById('login-view');
      const signupView = document.getElementById('signup-view');

      const openLoginBtns = [document.getElementById('open-login')]; // Agrega más si tienes
      const openSignupLabel = document.getElementById('open-signup');
      const backToLoginLabel = document.getElementById('back-to-login');

      const closeModalBtns = [
        document.getElementById('close-modal'),
        document.getElementById('close-modal-signup'),
      ];

      function openModal(view = 'login') {
        modal.style.display = 'flex';
        modal.setAttribute('aria-hidden', 'false');

        if (view === 'login') {
          loginView.style.display = 'block';
          signupView.style.display = 'none';
          document.getElementById('login-email').focus();
        } else {
          loginView.style.display = 'none';
          signupView.style.display = 'block';
          document.getElementById('signup-email').focus();
        }
      }

      function closeModal() {
        modal.style.display = 'none';
        modal.setAttribute('aria-hidden', 'true');
      }

      // Abrir login
      openLoginBtns.forEach((btn) =>
        btn?.addEventListener('click', () => openModal('login'))
      );

      // Abrir signup
      openSignupLabel?.addEventListener('click', () => openModal('signup'));

      // Volver a login desde el signup
      backToLoginLabel?.addEventListener('click', () => openModal('login'));

      // Cerrar modal desde cualquier botón
      closeModalBtns.forEach((btn) => btn?.addEventListener('click', closeModal));

      // Cerrar al hacer click fuera del modal
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
      });

      // Envío del login
      document.getElementById('login-form')?.addEventListener('submit', async function (e) {
        e.preventDefault();
        //Obtener valores de los inputs
        const correo = document.getElementById('login-email').value.trim();
        const contrasena = document.getElementById('login-password').value;

        try {
          //Hacer validación por backend
          const res = await fetch("/api/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ correo, contrasena })
          });

          const data = await res.json();

          if (res.ok) {
            alert("✅ Bienvenido " + data.usuario.nombre);
            // Guardar token si usas JWT
            if (data.token) {
            localStorage.setItem("token", data.token);
          }
            // Redirigir al mapa
            window.location.href = "map.html";
            closeModal();
          } else {
            alert("❌ Error: " + (data.error || "Credenciales inválidas"));
          }
          } catch (err) {
            console.error(err);
            alert("❌ Error de conexión con el servidor");
          }
      });

      // Envío del signup
      document.getElementById('signup-form')?.addEventListener('submit', async function (e) {
        e.preventDefault();
        // Obtener valores de los inputs
        const nombre = document.getElementById('name').value.trim();
        const correo = document.getElementById('signup-email').value.trim();
        const contrasena = document.getElementById('signup-password').value;
        const confirmar = document.getElementById('confirmpass').value;
        const adminCode = document.getElementById('admin-code')?.value?.trim();

        // Validar contraseñas
        if (contrasena !== confirmar) {
          alert("Las contraseñas no coinciden.");
          return;
        }

        try {
          // Enviar datos al backend
          const res = await fetch("/api/signup", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ nombre, correo, contrasena, adminCode })
          });

          const data = await res.json();

          if (res.ok) {
            alert("✅ Registro exitoso: " + data.message);
            document.getElementById('signup-form').reset();
            document.getElementById('signup-view').style.display = "none";
            window.location.href = 'map.html';
            closeModal();
          } else {
            alert("❌ Error: " + (data.error || "No se pudo registrar"));
          }
        } catch (err) {
          console.error(err);
          alert("❌ Error de conexión con el servidor");
        }
      });
    })();
      

  </script>
</body>
</html>
